{% extends 'base.html' %}
{% load static %}
{% block content %}
<div class="container px-4 py-5">
    <!-- 공지사항 영역 -->
    <div id="announcement">
        <h2 class="pb-2 border-bottom">커뮤니티</h2>
        <p>공지사항: 독후감을 써주세요. 1등 회원에겐 상품을 드립니다.</p>
    </div>
    <!-- 성길씨 Q&A에서 가져옴 나중에 왼쪽으로 띄울 예정 -->
    <aside class="left-menu">
        <div class="flex-shrink-0 p-3 bg-white" style="width: 180px; font-size : 16px;">
            <ul class="list-unstyled ps-0">
                <li class="mb-1">
                    <button class="btn btn-toggle align-items-center rounded" data-bs-toggle="collapse"
                            data-bs-target="#home-collapse" aria-expanded="true">
                        {% if current_category.slug %}
                        <h3>{{ current_category.slug }}</h3>
                        {% else %}
                        <h3>전체글</h3>
                        {% endif %}
                    </button>
                    <div class="collapse show" id="home-collapse" style="">
                        <ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small">
                            <!-- 전체글 -->
                            <li><a href="{% url 'community:community' %}" class="link-dark rounded">전체글</a></li>
                            <!-- 카테고리 이름으로 리스트 설정 -->
                            {% for category in categories %}
                            <li><a href="{{ category.get_absolute_url }}" class="link-dark rounded">
                                {{ category.name }}
                            </a></li>
                            {% endfor %}
                        </ul>
                    </div>
                </li>
            </ul>
        </div>
    </aside>
    <section id="community">
        <!-- 편집기 크기와 맞추려고 스타일 줌 -->
        <table class="table table-hover" style="width: 70%; margin: 0 auto;">
            <thead>
                <tr>
                    <td>번호</td>
                    <!-- 카테고리 추가 -->
                    <td>카테고리</td>
                    <td>제목</td>
                    <td>작성자</td>
                    <td>작성일</td>
                    <td>조회</td>
                    <td>추천</td>
                </tr>
            </thead>
            <tbody>
                <!-- post가 있으면 -->
                {% if post_list %}
                    <!-- 각 post별로 모두 -->
                    {% for post in post_list %}
                    <tr>
                        <!-- 번호 -->
                        <td>{{ post.id }}</td>
                        <!-- 카테고리 -->
                        <td>
                            {% if post.category %}
                            {{ post.category }}
                            {% endif %}
                        </td>
                        <!-- 제목 -->
                        <td>
                            <a href="{% url 'community:detail' post.id %}">
                                {{ post.title }}
                            </a>
                        </td>
                        <!-- 작성자 -->
                        <td>{{ post.writer }}</td>
                        <!-- 작성일 -->
                        <!-- 오늘 작성된 글은 오전/오후hh:mm으로 포맷변경 -->
                        {% if post.create_date|date:"Y-m-d" == today|date:"Y-m-d" %}
                            <td>{{ post.create_date|date:"Ag:i" }}</td>
                        <!-- 아니면 yy-mm-dd으로 포맷변경 -->
                        {% else %}
                            <td>{{ post.create_date|date:"y-m-d" }}</td>
                        {% endif %}
                        <!-- 조회수 -->
                        <td>{{ post.views }}</td>
                        <!-- 좋아요 -->
                        <td>{{ post.likes }}</td>
                    </tr>
                    {% endfor %}
                <!-- post가 없으면 -->
                {% else %}
                <tr>
                    <td colspan="6" class="text-center">게시글이 없습니다.</td>
                </tr>
                {% endif %}
            </tbody>
        </table>
        <!-- 로그인시에만 글쓰기 버튼 보이게 -->
        {% if user.is_authenticated %}
        <!-- 마진탑 -->
        <div id="btn_write" class="text-end mt-3">
            <a href="{% url 'community:post_create' %}" class="btn-a btn btn-primary">글쓰기</a>
        </div>
        {% endif %}
    </section>
</div>
{% endblock %}